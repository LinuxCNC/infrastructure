# Compile farm build script for RCSLIB
#
# platform specific info - hopefully this is all that changes
#
USRPLAT=nonrealtime
RTPLAT=realtime
#
# the "echo" commands add whitespace and command info
# to the log file to make the results easier to read 
#
echo
echo "setting up environment"
echo 
#export RTAIDIR=/usr/src/rtai
#echo "RTAIDIR = $RTAIDIR"
echo
echo "changing to rcslib/etc"
cd etc
echo
echo "running \"./configure\"" 
echo
if ! ( ./configure ) ; then exit 1 ; fi
echo
echo "changing to rcslib/src"
cd ..
cd src 
#
# all make commands are wrapped with "if" so that a
# failed command will terminate the entire build
#
echo
echo "running \"make clean PLAT=$USRPLAT\"" 
echo
if ! ( make clean PLAT=$USRPLAT ) ; then exit 1 ; fi
echo
echo "running \"make clean PLAT=$RTPLAT\"" 
echo
if ! ( make clean PLAT=$RTPLAT ) ; then exit 1 ; fi
echo
echo "running \"make make_dirs PLAT=$USRPLAT\"" 
echo
if ! ( make make_dirs PLAT=$USRPLAT ) ; then exit 1 ; fi
echo
echo "running \"make make_dirs PLAT=$RTPLAT\"" 
echo
if ! ( make make_dirs PLAT=$RTPLAT ) ; then exit 1 ; fi
echo
echo "running \"make headers PLAT=$USRPLAT\"" 
echo
if ! ( make headers PLAT=$USRPLAT ) ; then exit 1 ; fi
echo
echo "running \"make headers PLAT=$RTPLAT\"" 
echo
if ! ( make headers PLAT=$RTPLAT ) ; then exit 1 ; fi
echo
echo "running \"make depend PLAT=$USRPLAT\"" 
echo
if ! ( make depend PLAT=$USRPLAT ) ; then exit 1 ; fi
echo
echo "running \"make depend PLAT=$RTPLAT\"" 
echo
if ! ( make depend PLAT=$RTPLAT ) ; then exit 1 ; fi
echo
echo "running \"make all PLAT=$USRPLAT\"" 
echo
if ! ( make all PLAT=$USRPLAT ) ; then exit 1 ; fi
echo
echo "running \"make all PLAT=$RTPLAT\"" 
echo
if ! ( make all PLAT=$RTPLAT ) ; then exit 1 ; fi
echo
echo "deleting ../emc/README to force rebuild of emc"
rm -f ../../emc/README
echo
exit 0
